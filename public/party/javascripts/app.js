!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},i={},r=function(t,e){return{}.hasOwnProperty.call(t,e)},n=function(t,e){var i,r,n=[];i=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var o=0,s=i.length;s>o;o++)r=i[o],".."===r?n.pop():"."!==r&&""!==r&&n.push(r);return n.join("/")},o=function(t){return t.split("/").slice(0,-1).join("/")},s=function(e){return function(i){var r=o(e),s=n(r,i);return t.require(s,e)}},a=function(t,e){var r={id:t,exports:{}};return i[t]=r,e(r.exports,s(t),r),r.exports},p=function(t,o){var s=n(t,".");if(null==o&&(o="/"),r(i,s))return i[s].exports;if(r(e,s))return a(s,e[s]);var p=n(s,"./index");if(r(i,p))return i[p].exports;if(r(e,p))return a(p,e[p]);throw new Error('Cannot find module "'+t+'" from "'+o+'"')},l=function(t,i){if("object"==typeof t)for(var n in t)r(t,n)&&(e[n]=t[n]);else e[t]=i},c=function(){var t=[];for(var i in e)r(e,i)&&t.push(i);return t};t.require=p,t.require.define=l,t.require.register=l,t.require.list=c,t.require.brunch=!0}}(),require.register("application",function(t,e,i){var r,n,o;n=e("controllers/game_controller"),o=e("lib/mediator"),r={initialize:function(){return this.gameController=new n,"function"==typeof Object.freeze?Object.freeze(this):void 0}},i.exports=r}),require.register("controllers/game_controller",function(t,e,i){var r,n,o,s,a,p,l,c,u,h,d,v,y,m,f,g,b,_,w,x,k;d=e("views/map_view"),s=e("views/dj_view"),x=e("lib/mediator"),l=e("lib/event_broker"),m=e("models/player"),g=e("models/players"),f=e("views/player_list"),o=e("views/avatar"),a=e("views/drawing_canvas"),u=e("views/intro_view"),_=e("models/trailblazer"),w=e("lib/weather"),y=e("models/notifier"),h=e("views/join_game_view"),p=e("views/edit_avatar_view"),n=e("lib/autopilot"),v=e("lib/navi"),b=e("lib/reactor"),r=e("lib/admin"),k=e("lib/utils"),i.exports=c=function(){function t(){this.players=new g([]),this.notifier=new y,this.setupDJ(),this.setupMap(),this.setupCanvas(),this.setupPlayer(),this.setupSidebar(),this.admin=new r,this.subscribeEvent("addPlayer",this.addPlayer),this.subscribeEvent("triggerIntro",this.intro),this.subscribeEvent("togglePlayback",function(){return this.DJ.togglePlayback()}),this.createPlayerList(),x.game_state="playing"}return Backbone.utils.extend(t.prototype,l),t.prototype.players=[],t.prototype.multiplayer=!0,t.prototype.snow=!1,t.prototype.trails=!1,t.prototype.customNames=!0,t.prototype.clickToNavigate=!1,t.prototype.setupMap=function(){return this.mapView=new d({className:"map",el:document.getElementById("map"),autoRender:!0}),this.mapView.DJ=this.DJ,x=x,this.reactor=new b(this.mapView,this.players),this.nav=new v(this.mapView),this.snow?w.snow("snowCanvas"):void 0},t.prototype.setupDJ=function(){return this.DJ=new s},t.prototype.setupCanvas=function(){return this.canvas=new a({el:document.getElementById("drawCanvas"),autoRender:!0})},t.prototype.setupPlayer=function(){var t,e,i=this;return t=JSON.parse(localStorage.getItem("CremalabPartyAvatar")),x.current_player=new m(t),x.current_player.set({orientation:1,x_position:968,y_position:1384,active:!0,id:Date.now()}),e=this.intro(),this.mapView.listenTo(e,"dispose",function(){return i.drawOrPromptAvatar()}),this.multiplayer?this.notifier.connect(x.current_player,function(t){return t=t.split("players_")[1],i.mapView.setDimensions()}):void 0},t.prototype.drawOrPromptAvatar=function(){return x.current_player.get("name")?this.createPlayerAvatar(x.current_player):this.customNames?this.promptPlayerName():this.createPlayerAvatar(x.current_player)},t.prototype.promptPlayerName=function(t){var e,i,r=this;return e=x.current_player,i=t?new p({container:document.body,model:e}):new h({container:document.body,model:e}),x.current_player.listenTo(i,"setPlayerName",function(n){return i.dispose(),e.set("name",n),e.save(),t?void 0:r.createPlayerAvatar(e)})},t.prototype.createPlayerAvatar=function(t){var e;return e=new o({model:t}),e.autopilot=new n(e,this.mapView),this.trails&&(e.trailblazer=new _({player:t,avatar:e,canvas:this.canvas})),this.mapView.listenTo(e,"playerMove",this.mapView.checkPlayerPosition),this.mapView.spawnPlayer(t,e),this.players.add(t,{at:0}),this.mapView.addTouchEvents(e,"touchstart"),this.clickToNavigate&&this.mapView.addTouchEvents(e,"click"),this.setupGameMenu(),this.mapView.centerMapOn(t.get("x_position"),t.get("y_position"),0,20)},t.prototype.addPlayer=function(t,e){var i,r;return e&&parseFloat(t)!==parseFloat(x.current_player.id)&&!this.players.get(t)?(r=new m({id:t}),r.set(e),i=new o({model:r}),this.trails&&(i.trailblazer=new _({player:r,avatar:i,canvas:this.canvas})),this.mapView.listenTo(i,"playerMove",this.mapView.checkPlayerPosition),this.mapView.spawnPlayer(r,i),this.players.add(r)):void 0},t.prototype.createPlayerList=function(){return this.playerList=new f({collection:this.players,autoRender:!0,container:document.getElementById("player_list"),map:this.mapView})},t.prototype.setupGameMenu=function(){var t,e=this;return t=document.createElement("button"),document.getElementById("game-settings").appendChild(t),t.innerHTML="Edit",t.addEventListener("click",function(t){return t.preventDefault(),e.promptPlayerName(!0)})},t.prototype.intro=function(t){var e;return e=new u({container:document.body,triggerVolume:t})},t.prototype.setupSidebar=function(){var t,e,i=this;return e=document.querySelector(".sidebar-brand"),e.addEventListener("click",function(){return i.publishEvent("triggerIntro",!1)}),t=document.querySelector(".audioToggle"),t.addEventListener("click",function(){return i.publishEvent("togglePlayback"),t.classList.toggle("sub-muted")})},t}()}),require.register("initialize",function(t,e){var i;i=e("application"),document.addEventListener("DOMContentLoaded",function(){return i.initialize()})}),require.register("lib/actions",function(t,e,i){var r,n,o;n=e("views/modal_view"),o=e("lib/mediator"),r=e("lib/event_broker"),i.exports={team_photo:function(){var t;return"modal"!==o.game_state?(t=new n({container:document.body,className:"modal",template:e("views/templates/team_photo"),autoRender:!0}),o.game_state="modal"):void 0},bathroom_photo:function(){var t;return"modal"!==o.game_state&&(t=new n({container:document.body,className:"modal",template:e("views/templates/bathroom_photo"),autoRender:!0})),this.audio.paused?o.game_state="modal":void 0},lamp_light:function(t,e){var i;return i=e[0],i.img?i.lamp_on?(i.img.setAttribute("src","party/images/lamp_1.png"),i.lamp_on=!1):(i.img.setAttribute("src","party/images/lamp_2.png"),i.lamp_on=!0):void 0},lamp_light_flip:function(t,e){var i;return i=e[0],i.img?i.lamp_on?(i.img.setAttribute("src","party/images/lamp_1_flip.png"),i.lamp_on=!1):(i.img.setAttribute("src","party/images/lamp_2_flip.png"),i.lamp_on=!0):void 0},tweet_friends:function(t,e){return window.open(e[0],"twitter")},disco:function(t){var e;return e=t.el.classList,e.contains("disco-time")?(e.remove("disco-time"),t.DJ.playTrack("soundtrack")):(e.add("disco-time"),t.DJ.playTrack("disco"))}}}),require.register("lib/activist",function(t,e,i){var r,n,o=function(t,e){return function(){return t.apply(e,arguments)}};n=e("lib/event_broker"),i.exports=r=function(){function t(t){this.handleKeyDown=o(this.handleKeyDown,this),this.landscaper=t,document.addEventListener("keydown",this.handleKeyDown),this.subscribeEvent("map:interact",this.handleTap)}return Backbone.utils.extend(t.prototype,n),t.prototype.actionKey=32,t.prototype.actionableItems=[],t.prototype.activate=function(t){return t.onHit=t.onHit||{},t.events={},t.addEventListener=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},t.raiseEvent=function(t,e){var i,r;if(i=this.events[t])for(r=0;r<i.length;)"function"==typeof i[r]&&i[r](e),r++},this.addActor(t),t},t.prototype.addActor=function(t){return t.addEventListener("hit_left",function(e){return t.onHit.left?t.onHit.left(t,e):void 0}),t.addEventListener("hit_right",function(e){return t.onHit.right?t.onHit.right(t,e):void 0}),t.addEventListener("hit_top",function(e){return t.onHit.top?t.onHit.top(t,e):void 0}),t.addEventListener("hit_bottom",function(e){return t.onHit.bottom?t.onHit.bottom(t,e):void 0}),t.addEventListener("hit_any",function(e){return t.onHit.any?t.onHit.any(t,e):void 0}),t.addEventListener("enterProximity",function(e){return t.current_player_within_proximity=!0,t.proximity?t.proximity.onEnter(t,e):void 0}),t.addEventListener("leaveProximity",function(e){return t.current_player_within_proximity=!1,t.proximity?t.proximity.onLeave(t,e):void 0}),t.proximity&&t.proximity.keys&&t.proximity.keys.hasOwnProperty("action")?(this.actionableItems.push(t),console.log(t.id)):void 0},t.prototype.handleKeyDown=function(t){switch(t.keyCode){case 32:return this.fireActionHandlers()}},t.prototype.handleTap=function(t,e,i){var r,n,o,s,a,p;for(a=this.actionableItems,p=[],o=0,s=a.length;s>o;o++)n=a[o],n.current_player_within_proximity?(r={width:10,height:10},this.landscaper.avatarOverlaps(r,n,e-this.landscaper.map.offset_x,i-this.landscaper.map.offset_y)?(t.preventDefault(),t.stopPropagation(),p.push(n.proximity.keys.action(n))):p.push(void 0)):p.push(void 0);return p},t.prototype.fireActionHandlers=function(){var t,e,i,r,n;for(r=this.actionableItems,n=[],e=0,i=r.length;i>e;e++)t=r[e],n.push(t.current_player_within_proximity?t.proximity.keys.action(t):void 0);return n},t}()}),require.register("lib/admin",function(t,e,i){var r,n,o;o=e("lib/mediator"),n=e("lib/event_broker"),i.exports=r=function(){function t(){this.subscribeEvent("admin:init",this.init)}return Backbone.utils.extend(t.prototype,n),t.prototype.init=function(){return o.game_state="admin",this.subscribeEvent("clickAvatar",this.kickPlayer),document.body.classList.add("admin")},t.prototype.kickPlayer=function(t,e){var i;return i=confirm("Kick "+e.get("name")+"?"),i?this.publishEvent("admin:kick",e.id):void 0},t.prototype.uninit=function(){return o.game_state="playing",this.unsubscribeEvent("clickAvatar",this.kickPlayer),document.body.classList.remove("admin")},t}()}),require.register("lib/autopilot",function(t,e,i){var r;i.exports=r=function(){function t(t,e){this.avatar=t,this.map=e}return t.prototype.travelToPoint=function(t){return t.x=t.x-this.map.offset_x,t.y=t.y-this.map.offset_y,this.travelAvatar(t)},t.prototype.travelAvatar=function(t){var e=this;return this.avatar.moving||this.avatar.movementLoop?void 0:(this.avatar.clearMovementClasses(),this.avatar.movementLoop=setInterval(function(){var i,r;return i=e.getCurrentPosition(),r=e.avatar.directionsByName,t.x=t.x,t.y=t.y,e.avatar.isCloseEnoughTo(t.x,t.y)?e.avatar.stopMovement():(i.x>t.x&&!(Math.abs(i.x-t.x)<10)?e.avatar.addActiveMovementKey(r.left):e.avatar.stopMovementDirection(r.left),i.x<t.x&&!(Math.abs(i.x-t.x)<10)?e.avatar.addActiveMovementKey(r.right):e.avatar.stopMovementDirection(r.right),i.y<t.y&&!(Math.abs(i.y-t.y)<10)?e.avatar.addActiveMovementKey(r.down):e.avatar.stopMovementDirection(r.down),i.y>t.y&&!(Math.abs(i.y-t.y)<10)?e.avatar.addActiveMovementKey(r.up):e.avatar.stopMovementDirection(r.up),e.avatar.move())},this.avatar.movementLoopInc))},t.prototype.getCurrentPosition=function(){var t;return t={x:this.avatar.model.get("x_position"),y:this.avatar.model.get("y_position")}},t}()}),require.register("lib/chatterbox",function(t,e,i){var r,n,o,s,a,p,l={}.hasOwnProperty,c=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};s=e("models/model"),r=e("views/chat_input_view"),n=e("models/chat_message"),a=e("views/speech_bubble_view"),i.exports=o=function(t){function e(){return p=e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.subscribeEvent("messages:received:"+this.get("player").id,this.renderSpeechBubble),this.subscribeEvent("messages:dismissed:"+this.get("player").id,this.disposeBubble)},e.prototype.handleEnter=function(){return this.open?this.submit():this.openDialog()},e.prototype.openDialog=function(){return this.speechBubble&&this.speechBubble.dispose(),this.open=!0,this.message=new n({uuid:this.get("player").id}),this.dialog=new r({container:this.get("avatar").el,autoRender:!0,model:this.message,avatar:this.get("avatar")})},e.prototype.submit=function(){var t;return t=this.dialog.el.querySelector("[name='chat_text']").value,"/admin"===t?(this.publishEvent("admin:init"),this.open=!1,this.dialog.dispose()):(this.open=!1,t&&(this.message.set({content:t}),this.message.save(),this.renderSpeechBubble(this.message)),this.dialog.dispose())},e.prototype.renderSpeechBubble=function(t){return t instanceof n||(t=new n(t)),this.speechBubble&&this.speechBubble.dispose(),this.speechBubble=new a({container:this.get("avatar").el,autoRender:!0,avatar:this.get("avatar"),model:t,chatterBox:this}),this.message=t},e.prototype.disposeBubble=function(t){return this.open=!1,this.message&&this.message.dispose(),this.dialog&&this.dialog.dispose(),this.speechBubble&&this.speechBubble.dispose(),t?this.publishEvent("messages:dismissed",this.get("player").id):void 0},e}(s)}),require.register("lib/escort",function(t,e,i){var r;r="players_",i.exports={capacity:50,findEmptyRoom:function(t,e){return this.testRoom(t,1,e)},testRoom:function(t,e,i){var n=this;return t.here_now({channel:r+e,callback:function(o){return o.uuids.length>=n.capacity?n.testRoom(t,e+1,i):i(r+e)}})}}}),require.register("lib/event_broker",function(t,e,i){"use strict";var r,n,o=[].slice;n=e("lib/mediator"),r={subscribeEvent:function(t,e){if("string"!=typeof t)throw new TypeError("EventBroker#subscribeEvent: type argument must be a string");if("function"!=typeof e)throw new TypeError("EventBroker#subscribeEvent: handler argument must be a function");return n.unsubscribe(t,e,this),n.subscribe(t,e,this)},subscribeEventOnce:function(t,e){if("string"!=typeof t)throw new TypeError("EventBroker#subscribeEventOnce: type argument must be a string");if("function"!=typeof e)throw new TypeError("EventBroker#subscribeEventOnce: handler argument must be a function");return n.unsubscribe(t,e,this),n.subscribeOnce(t,e,this)},unsubscribeEvent:function(t,e){if("string"!=typeof t)throw new TypeError("EventBroker#unsubscribeEvent: type argument must be a string");if("function"!=typeof e)throw new TypeError("EventBroker#unsubscribeEvent: handler argument must be a function");return n.unsubscribe(t,e)},unsubscribeAllEvents:function(){return n.unsubscribe(null,null,this)},publishEvent:function(){var t,e;if(e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],"string"!=typeof e)throw new TypeError("EventBroker#publishEvent: type argument must be a string");return n.publish.apply(n,[e].concat(o.call(t)))}},"function"==typeof Object.freeze&&Object.freeze(r),i.exports=r}),require.register("lib/landscape",function(t,e,i){var r;r=e("lib/event_broker"),i.exports=[{id:"table",src:"/party/images/table.png",x:260,y:400},{id:"table2",src:"/party/images/table.png",x:25,y:400},{id:"table3",src:"/party/images/table.png",x:25,y:475},{id:"table4",src:"/party/images/table.png",x:260,y:475},{id:"table5",src:"/party/images/table.png",x:25,y:800},{id:"table8",src:"/party/images/table.png",x:260,y:800},{id:"table6",src:"/party/images/table.png",x:25,y:875},{id:"table7",src:"/party/images/table.png",x:260,y:875},{id:"mac",src:"/party/images/mac.png",x:345,y:480,ghosty:!0},{id:"mac2",src:"/party/images/mac.png",x:115,y:480,ghosty:!0},{id:"mac3",src:"/party/images/mac.png",x:345,y:880,ghosty:!0},{id:"mac4",src:"/party/images/mac.png",x:115,y:880,ghosty:!0},{id:"macflip",src:"/party/images/mac_flip.png",x:345,y:410,ghosty:!0},{id:"macflip2",src:"/party/images/mac_flip.png",x:115,y:410,ghosty:!0},{id:"macflip3",src:"/party/images/mac_flip.png",x:345,y:810,ghosty:!0},{id:"macflip4",src:"/party/images/mac_flip.png",x:115,y:810},{id:"table_vertical",src:"/party/images/table_vertical.png",x:900,y:400},{id:"table_vertical2",src:"/party/images/table_vertical.png",x:970,y:400},{id:"table_vertical3",src:"/party/images/table_vertical.png",x:970,y:635},{id:"table_vertical4",src:"/party/images/table_vertical.png",x:900,y:635},{id:"orange_chair",src:"/party/images/orange_chair.png",x:850,y:725},{id:"red_chair",src:"/party/images/red_chair.png",x:1050,y:680},{id:"red_chair2",src:"/party/images/red_chair.png",x:300,y:960},{id:"red_chair3",src:"/party/images/red_chair.png",x:130,y:960},{id:"orange_chair5",src:"/party/images/orange_chair.png",x:310,y:1120},{id:"red_chair5",src:"/party/images/red_chair.png",x:300,y:1260},{id:"red_chair4",src:"/party/images/red_chair.png",x:350,y:560},{id:"orange_chair3",src:"/party/images/orange_chair.png",x:358,y:345},{id:"orange_chair4",src:"/party/images/orange_chair.png",x:375,y:745},{id:"orange_chair2",src:"/party/images/orange_chair.png",x:1050,y:390},{id:"bookshelf",src:"/party/images/bookshelf.png",x:25,y:55},{id:"bookshelf2",src:"/party/images/bookshelf.png",x:110,y:55},{id:"bookshelf3",src:"/party/images/bookshelf.png",x:195,y:55},{id:"bookshelf5",src:"/party/images/bookshelf.png",x:280,y:55},{id:"bookshelf4",src:"/party/images/bookshelf.png",x:690,y:55},{id:"couch",src:"/party/images/couch.png",x:495,y:475},{id:"couch2",src:"/party/images/couch.png",x:495,y:875},{id:"couch_flip",src:"/party/images/couch_flip.png",x:335,y:1175},{id:"sharpie_table",src:"/party/images/sharpie_table.png",x:190,y:550},{id:"sharpie_table2",src:"/party/images/sharpie_table.png",x:215,y:740},{id:"sharpie_table3",src:"/party/images/sharpie_table.png",x:70,y:340},{id:"office_table",src:"/party/images/office_table.png",x:1640,y:1075},{id:"long_cabinet",src:"/party/images/long_cabinet.png",x:500,y:80},{id:"long_cabinet2",src:"/party/images/long_cabinet.png",x:775,y:80},{id:"container",src:"/party/images/container.png",x:965,y:80},{id:"container2",src:"/party/images/container.png",x:1015,y:80},{id:"container3",src:"/party/images/container.png",x:1065,y:80},{id:"office_chair",src:"/party/images/office_chair.png",x:1810,y:1130},{id:"office_chair2",src:"/party/images/office_chair.png",x:1810,y:1230},{id:"office_chair3",src:"/party/images/office_chair.png",x:1810,y:1330},{id:"office_chair4",src:"/party/images/office_chair.png",x:1810,y:1430},{id:"office_chair_flip",src:"/party/images/office_chair_flip.png",x:1605,y:1130},{id:"office_chair_flip2",src:"/party/images/office_chair_flip.png",x:1605,y:1230},{id:"office_chair_flip3",src:"/party/images/office_chair_flip.png",x:1605,y:1330},{id:"office_chair_flip4",src:"/party/images/office_chair_flip.png",x:1605,y:1430},{id:"desk_chair",src:"/party/images/desk_chair.png",x:1055,y:500},{id:"desk_chair2",src:"/party/images/desk_chair.png",x:1055,y:750},{id:"desk_chair_flip",src:"/party/images/desk_chair_flip.png",x:870,y:500},{id:"desk_chair_flip2",src:"/party/images/desk_chair_flip.png",x:870,y:750},{id:"fridge",src:"/party/images/fridge.png",x:1125,y:50,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"[Interact] View the curious photo on the fridge",id:"fridge_hint",position:"right"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","fridge_hint")},keys:{action:function(){return r.publishEvent("reactor:act","team_photo")}}}},{id:"wall",src:"/party/images/wall.png",x:1630,zIndex:10,y:285},{id:"door",src:"/party/images/door.png",x:1780,zIndex:50,y:315,proximity:{radius:10,onEnter:function(t){var e;return e={obstruction:t,text:"[Interact] Knock on the door?",id:"bathroom_hint"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","bathroom_hint")},keys:{action:function(){return r.publishEvent("reactor:act","bathroom_photo")}}}},{id:"wall_2",src:"/party/images/wall_2.png",x:1630,zIndex:20,y:0},{id:"wall_3",src:"/party/images/wall3.png",x:1430,y:835},{id:"wall_4",src:"/party/images/wall4.png",x:1408,y:835},{id:"counter",src:"/party/images/counter.png",x:1590,y:80,zIndex:25},{id:"counter_2",src:"/party/images/counter_2.png",x:1222,y:82},{id:"coffee_table",src:"/party/images/coffee_table.png",x:200,y:1160},{id:"front_table",src:"/party/images/front_table.png",x:900,y:1060},{id:"tree",src:"/party/images/tree1.png",x:1485,y:530},{id:"plant",src:"/party/images/plant.png",x:955,y:590,ghosty:!0},{id:"Lamp",src:"/party/images/lamp_1.png",x:990,y:380,zIndex:400,proximity:{radius:60,onEnter:function(t){return r.publishEvent("reactor:act","lamp_light",t)},onLeave:function(t){return r.publishEvent("reactor:act","lamp_light",t)}}},{id:"Lamp2",src:"/party/images/lamp_1_flip.png",x:920,y:680,proximity:{radius:60,onEnter:function(t){return r.publishEvent("reactor:act","lamp_light_flip",t)},onLeave:function(t){return r.publishEvent("reactor:act","lamp_light_flip",t)}}},{id:"Lamp3",src:"/party/images/lamp_1_flip.png",x:190,y:400,proximity:{radius:60,onEnter:function(t){return r.publishEvent("reactor:act","lamp_light_flip",t)},onLeave:function(t){return r.publishEvent("reactor:act","lamp_light_flip",t)}}},{id:"Lamp4",src:"/party/images/lamp_1.png",x:270,y:800,proximity:{radius:60,onEnter:function(t){return r.publishEvent("reactor:act","lamp_light",t)},onLeave:function(t){return r.publishEvent("reactor:act","lamp_light",t)}}},{id:"ipad",src:"/party/images/ipad.png",x:990,y:480,ghosty:!0,mirror:!0},{id:"ipad4",src:"/party/images/ipad.png",x:915,y:755,ghosty:!0},{id:"ipad3",src:"/party/images/ipad.png",x:435,y:515,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"[Interact] Start the dance party",id:"disco_hint"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","disco_hint")},keys:{action:function(){return r.publishEvent("reactor:act","disco")}}}},{id:"ipad2",src:"/party/images/ipad.png",x:630,y:75,ghosty:!0,mirror:!0},{id:"flamingo",src:"/party/images/flamingo.png",x:930,y:525,ghosty:!0},{id:"dan",src:"/party/images/dan.png",x:390,y:70,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Go Jayhawks!",id:"dan_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","dan_talk")}}},{id:"george",src:"/party/images/george.png",x:1070,y:1170,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Welcome to Cremalab! Try and find the hidden disco mode!",id:"george_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","george_talk")}}},{id:"nate",src:"/party/images/nate.png",x:120,y:520,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"[interact] Invite your friends to the party!",id:"nate_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","nate_talk")},keys:{action:function(){return r.publishEvent("reactor:act","tweet_friends","https://twitter.com/home?status=Have%20you%20visited%20the%20%23CremaChristmas%20party%20yet?%20@Cremalab%20used%20@PubNub%20@Brunch%20to%20bring%20it%20to%20life.%20Come%20join%20me!%20cremalab.com/party")}}}},{id:"rob",src:"/party/images/rob.png",x:1520,y:120,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Did you bring any food?",id:"rob_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","rob_talk")}}},{id:"ross",src:"/party/images/ross.png",x:1450,y:900,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Leave me alone! I'm working!",id:"ross_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","ross_talk")}}},{id:"deric",src:"/party/images/deric.png",x:380,y:1170,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"We hope you and your family have a great holiday season!",id:"deric_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","deric_talk")}}},{id:"kelly",src:"/party/images/kelly.png",x:1410,y:580,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Welcome to our space. Come back anytime!",id:"kelly_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","kelly_talk")}}},{id:"John",src:"/party/images/john.png",x:820,y:1180,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Life's a garden... Dig it!",id:"john_talk"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","john_talk")}}},{id:"present21",src:"/party/images/present_32.png",x:1470,y:655,ghosty:!0},{id:"present22",src:"/party/images/present_2.png",x:1560,y:645},{id:"present23",src:"/party/images/present_2.png",x:940,y:425,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Ross wants a new synthesizer!",id:"ross_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","ross_present")}}},{id:"present24",src:"/party/images/present_31.png",x:995,y:515,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Rob wants the new Call of Duty!",id:"rob_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","rob_present")}}},{id:"present1",src:"/party/images/present_1.png",x:1495,y:650,ghosty:!0},{id:"present6",src:"/party/images/present_3.png",x:1535,y:655,ghosty:!0},{id:"present2",src:"/party/images/present_22.png",x:1515,y:655,ghosty:!0},{id:"present3",src:"/party/images/present_21.png",x:925,y:805,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Deric wants more Sriracha sauce!",id:"deric_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","deric_present")}}},{id:"present4",src:"/party/images/present_3.png",zIndex:100,x:525,y:75,ghosty:!0},{id:"present41",src:"/party/images/present_31.png",zIndex:100,x:825,y:75,ghosty:!0},{id:"present25",src:"/party/images/present_2.png",zIndex:100,x:803,y:68,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"George wants shoes as cool as Bishop's!",id:"george_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","george_present")}}},{id:"present26",src:"/party/images/present_22.png",zIndex:1e3,x:195,y:498,ghosty:!0},{id:"present27",src:"/party/images/present_2.png",zIndex:1e3,x:195,y:798,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Matt wants a new messenger bag!",id:"matt_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","matt_present")}}},{id:"present51",src:"/party/images/present_21.png",x:225,y:1160,ghosty:!0},{id:"present5",src:"/party/images/present_31.png",x:240,y:1175,ghosty:!0},{id:"present7",src:"/party/images/present_35.png",x:220,y:895,ghosty:!0},{id:"present72",src:"/party/images/present_31.png",x:415,y:910,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Michael wants an iPad air 2!",id:"michael_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","michael_present")}}},{id:"present71",src:"/party/images/present_22.png",x:205,y:895,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Bishop wants an iPhone 6+!",id:"bishop_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","bishop_present")}}},{id:"present8",src:"/party/images/present_35.png",x:1015,y:785,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"John wants something purple!",id:"john_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","john_present")}}},{id:"present81",src:"/party/images/present_32.png",x:1015,y:635,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Kelly wants more cheese!",id:"kelly_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","kelly_present")}}},{id:"present9",src:"/party/images/present_33.png",x:430,y:410,proximity:{radius:60,onEnter:function(t){var e;return e={obstruction:t,text:"Dan wants KU basketball tickets!",id:"dan_present"},r.publishEvent("navi:hint",e)},onLeave:function(){return r.publishEvent("navi:dismiss_hint","dan_present")}}},{id:"present11",src:"/party/images/present_2.png",x:1510,y:65,zIndex:100,ghosty:!0},{id:"present10",src:"/party/images/present_32.png",x:1530,y:80,zIndex:100,ghosty:!0}]}),require.register("lib/landscaper",function(t,e,i){var r,n;r=e("lib/activist"),i.exports=n=function(){function t(t){this.map=t.map}return t.prototype.landscape=e("lib/landscape"),t.prototype.obstructions=[],t.prototype.current_player_overlaps=[],t.prototype.init=function(){var t,e,i,n,o,s;for(this.activist=new r(this),o=this.landscape,s=[],i=0,n=o.length;n>i;i++)t=o[i],t.hasOwnProperty("src")?(e=this.createObstructionGraphic(t),t=this.activist.activate(t),s.push(t.ghosty?void 0:this.obstructions.push(t))):s.push(void 0);return s},t.prototype.createObstructionGraphic=function(t){var e,i,r;return r=""+t.x+"px, "+t.y+"px",i=document.createElement("img"),i.id=t.id,i.setAttribute("src",t.src),i=this.map.el.appendChild(i),e=t.src.split("."),e=e[e.length-1],i.style.top=""+t.y+"px",i.style.left=""+t.x+"px",i.classList.add("obstruction"),"svg"===e?this.createSVG(t,i):this.createImage(t,i)},t.prototype.createSVG=function(t,e){return SVGInjector(e,{},function(){var i;return e=document.querySelector("svg#"+t.id),i=e.getBBox(),e.x=t.x,e.y=t.y,t.left=t.x,t.top=t.y,t.right=t.x+i.width,t.bottom=t.y+i.height,e.classList.add("svg"),t.mirror&&(e.style.webkitTransform="scaleX(-1)"),t.svg=e})},t.prototype.createImage=function(t,e){return e=document.getElementById(t.id),imagesLoaded(e,function(){var i;return i=e.getClientRects()[0],t.left=t.x,t.top=t.y,t.right=t.x+i.width,t.bottom=t.y+i.height,e.classList.add("img"),e.style.zIndex=t.zIndex||t.y,t.mirror&&(e.style.webkitTransform="scaleX(-1)"),t.img=e})},t.prototype.checkObstructions=function(t,e,i,r){var n,o,s,a,p;for(n={right:!0,left:!0,up:!0,down:!0},this.rights=[],this.ups=[],this.lefts=[],this.downs=[],p=this.obstructions,s=0,a=p.length;a>s;s++)o=p[s],this.getObstructionShape(o,t,e,i);return n.right=this.rights.indexOf(!1)<0,n.left=this.lefts.indexOf(!1)<0,n.up=this.ups.indexOf(!1)<0,n.down=this.downs.indexOf(!1)<0,t+i.width>r.width&&(n.right=!1),0>t&&(n.left=!1),e+i.height+r.padding_bottom>=r.height&&(n.down=!1),e+i.height-r.padding_top<0&&(n.up=!1),i.availableDirections=n,i.trigger("availableDirectionsUpdated",t,e)},t.prototype.getObstructionShape=function(t,e,i,r){var n,o;return n=t.svg?t.svg.createSVGRect():r.rect,n.height=r.height,n.width=r.width,o=r.model,n.x=o.get("x_position"),n.y=o.get("y_position"),this.checkIntersections(t,n,o,e,i,r),t.proximity?this.checkProximities(n,t,e,i,r):void 0},t.prototype.checkIntersections=function(t,e,i,r,n,o){return r<e.x&&(e.x=r,this.determineDirections(e,t,this.lefts,"right",r,n,o),e.x=i.get("x_position")),r>e.x&&(e.x=r,this.determineDirections(e,t,this.rights,"left",r,n,o),e.x=i.get("x_position")),n<e.y&&(e.y=n,this.determineDirections(e,t,this.ups,"bottom",r,n,o),e.y=i.get("y_position")),n>e.y?(e.y=n,this.determineDirections(e,t,this.downs,"top",r,n,o),e.y=i.get("y_position")):void 0},t.prototype.checkProximities=function(t,e,i,r,n){var o,s;if(s=e.proximity.radius,!s)throw new Error("Proximity declaration of "+e.id+" needs a radius");if(o={top:e.top-s,bottom:e.bottom+s,left:e.left-s,right:e.right+s},this.avatarOverlaps(n,o,i,r)){if(!e.current_player_overlap)return this.current_player_overlaps.push(e.id),e.current_player_overlap=!0,e.raiseEvent("enterProximity")}else if(this.current_player_overlaps.indexOf(e.id)>-1)return e.raiseEvent("leaveProximity"),this.current_player_overlaps.splice(this.current_player_overlaps.indexOf(e.id),1),e.current_player_overlap=!1},t.prototype.determineDirections=function(t,e,i,r,n,o,s){return e.svg?this.determineSVGDirections(t,e,i,r,n,o,s):this.determineImgDirections(t,e,i,r,n,o,s)
},t.prototype.determineImgDirections=function(t,e,i,r,n,o,s){return this.avatarOverlaps(s,e,n,o)?(i.push(!1),this.dispatchHitActions(e,r,n,o,s)):i.push(!0)},t.prototype.determineSVGDirections=function(t,e,i,r,n,o,s){return e.svg.getIntersectionList(t,null).length<1?i.push(!0):(i.push(!1),this.dispatchHitActions(e,r,n,o,s))},t.prototype.dispatchHitActions=function(t,e,i,r,n){var o;return o={avatar:n,x:i,y:r},t.raiseEvent("hit_"+e,o),t.raiseEvent("hit_any",o)},t.prototype.avatarOverlaps=function(t,e,i,r){var n,o,s,a;return s=i+t.width<e.left,a=i>e.right,o=r>e.bottom,n=r+t.height<e.top,!(s||a||n||o)},t}()}),require.register("lib/mediator",function(t,e,i){"use strict";var r,n,o=[].slice;n={},n.subscribe=n.on=Backbone.Events.on,n.subscribeOnce=n.once=Backbone.Events.once,n.unsubscribe=n.off=Backbone.Events.off,n.publish=n.trigger=Backbone.Events.trigger,n._callbacks=null,n.current_player=null,n.game_state=null,r=n._handlers={},n.setHandler=function(t,e,i){return r[t]={instance:i,method:e}},n.execute=function(){var t,e,i,n,s;if(n=arguments[0],t=2<=arguments.length?o.call(arguments,1):[],s=!1,"object"==typeof n?(s=n.silent,i=n.name):i=n,e=r[i])return e.method.apply(e.instance,t);if(!s)throw new Error("mediator.execute: "+i+" handler is not defined")},n.removeHandlers=function(t){var e,i,o,s;if(t||(n._handlers={}),Array.isArray(t))for(o=0,s=t.length;s>o;o++)i=t[o],delete r[i];else for(i in r)e=r[i],e.instance===t&&delete r[i]},n.seal=function(){return support.propertyDescriptors&&Object.seal?Object.seal(n):void 0},i.exports=n}),require.register("lib/navi",function(t,e,i){var r,n,o,s;r=e("lib/event_broker"),n=e("models/hint"),o=e("views/hint_view"),i.exports=s=function(){function t(t){this.map=t,this.subscribeEvent("navi:hint",this.hint),this.subscribeEvent("navi:dismiss_hint",this.removeHint)}return Backbone.utils.extend(t.prototype,r),t.prototype.subviews=[],t.prototype.hints=[],t.prototype.hint=function(t){var e,i;return e=new n(t),this.hints.push(e),i=new o({model:e,container:this.map.el,autoRender:!0}),this.subviews.push(i)},t.prototype.removeHint=function(t){var e;return e=this.hints.filter(function(e){return e.id===t}),e=e[0],e?(e.dispose(),this.hints.splice(this.hints.indexOf(e),1),this.subviews.splice(this.hints.indexOf(e),1)):void 0},t}()}),require.register("lib/reactor",function(t,e,i){var r,n,o,s,a=[].slice;r=e("lib/event_broker"),s=e("lib/mediator"),o=e("lib/actions"),i.exports=n=function(){function t(t,e){var i=this;this.map=t,this.players=e,this.actions=o,this.subscribeEvent("reactor:act",function(){var t,e;return t=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],i.actions[t](i.map,e)})}return Backbone.utils.extend(t.prototype,r),t}()}),require.register("lib/utils",function(t,e,i){var r,n=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};r={getAllPropertyVersions:function(t,e){var i,o,s,a,p,l;for(o=[],l=r.getPrototypeChain(t),a=0,p=l.length;p>a;a++)i=l[a],s=i[e],s&&n.call(o,s)<0&&o.push(s);return o},serialize:function(t){if("function"==typeof t.serialize)return t.serialize();if("function"==typeof t.toJSON)return t.toJSON();throw new TypeError("utils.serialize: Unknown data was passed")},getPrototypeChain:function(t){var e,i,r,n,o;for(e=[t.constructor.prototype];t=null!=(i=null!=(r=t.constructor)&&null!=(n=r.superclass)?n.prototype:void 0)?i:null!=(o=t.constructor)?o.__super__:void 0;)e.push(t);return e.reverse()}},i.exports=r}),require.register("lib/weather",function(t,e,i){var r,n,o,s,a,p,l,c;n=200,s=-100,a=-100,o=[],p=function(t,e){t.x=Math.floor(Math.random()*e.width),t.y=0,t.size=3*Math.random()+2,t.speed=1*Math.random()+.5,t.velY=t.speed,t.velX=0,t.opacity=.5*Math.random()+.3},l=function(t){var e,i,p,l,c,u,h,d,v;for(c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},window.requestAnimationFrame=c,e=document.getElementById(t),i=e.getContext("2d"),e.width=window.innerWidth,e.height=window.innerHeight,e.addEventListener("mousemove",function(t){s=t.clientX,a=t.clientY}),p=0;n>p;)d=Math.floor(Math.random()*e.width),v=Math.floor(Math.random()*e.height),u=3*Math.random()+2,h=1*Math.random()+.5,l=.5*Math.random()+.3,o.push({speed:h,velY:h,velX:0,x:d,y:v,size:u,stepSize:Math.random()/30,step:0,angle:180,opacity:l}),p++;r(i,e)},r=function(t,e){var i,l,c,u,h,d,v,y,m,f,g,b,_,w;for(t.clearRect(0,0,e.width,e.height),v=0;n>v;)h=o[v],m=s,b=a,y=150,f=h.x,_=h.y,l=Math.sqrt((f-m)*(f-m)+(_-b)*(_-b)),c=f-m,u=_-b,y>l?(d=y/(l*l),g=(m-f)/l,w=(b-_)/l,i=d/2,h.velX-=i*g,h.velY-=i*w):(h.velX*=.98,h.velY<=h.speed&&(h.velY=h.speed),h.velX+=Math.cos(h.step+=.05)*h.stepSize),t.fillStyle="rgba(255,255,255,"+h.opacity+")",h.y+=h.velY,h.x+=h.velX,(h.y>=e.height||h.y<=0)&&p(h,e),(h.x>=e.width||h.x<=0)&&p(h,e),t.beginPath(),t.arc(h.x,h.y,h.size,0,2*Math.PI),t.fill(),v++;requestAnimationFrame(function(){return r(t,e)})},c={snow:function(t){return l(t)}},i.exports=c}),require.register("models/chat_message",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("models/model"),i.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.save=function(){return this.publishEvent("messages:saved",this.attributes)},e}(n)}),require.register("models/collection",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("lib/event_broker"),i.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),Backbone.utils.extend(e.prototype,n),e}(Backbone.Collection)}),require.register("models/hint",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("models/model"),i.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e}(n)}),require.register("models/model",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};r=e("lib/event_broker"),i.exports=n=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),Backbone.utils.extend(e.prototype,r),e.prototype.disposed=!1,e.prototype.dispose=function(){var t,e,i,r;if(!this.disposed){for(this.trigger("dispose",this),this.unsubscribeAllEvents(),this.stopListening(),this.off(),e=["collection","attributes","changed","defaults","_escapedAttributes","_previousAttributes","_silent","_pending","_callbacks"],i=0,r=e.length;r>i;i++)t=e[i],delete this[t];return this.disposed=!0}},e}(Backbone.Model)}),require.register("models/notifier",function(t,e,i){var r,n,o,s,a,p,l={}.hasOwnProperty,c=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};a=e("lib/mediator"),o=e("models/model"),r=e("lib/escort"),n=e("views/modal_view"),i.exports=s=function(t){function i(){return p=i.__super__.constructor.apply(this,arguments)}return c(i,t),i.prototype.connect=function(t,e){var i=this;return this.player=t,this.PN=PUBNUB.init({publish_key:"pub-c-7f96182e-eed7-46dd-9b72-80d838427d8e",subscribe_key:"sub-c-b9f703c2-7109-11e4-aacc-02ee2ddab7fe",uuid:t.get("id"),heartbeat:10,restore:!1}),r.findEmptyRoom(this.PN,function(t){var r;return i.subscribe(t,e),i.subscribeEvent("playerMoved",i.publishPlayerMovement),i.subscribeEvent("players:left",i.removePlayer),i.subscribeEvent("messages:saved",i.publishMessage),i.subscribeEvent("messages:dismissed",i.dismissMessage),i.subscribeEvent("players:name_changed",i.setAttrs),i.subscribeEvent("players:avatar_changed",i.setAttrs),i.subscribeEvent("admin:kick",i.publishKick),r=i.PN,window.addEventListener("beforeunload",function(){return i.PN.unsubscribe({channel:i.channel})})})},i.prototype.subscribe=function(t,e){var i,r=this;return i=this.player.toJSON(),delete i.active,this.PN.subscribe({channel:t,presence:function(t){return r.handlePresence(t)},message:function(t){return r.message(t)},state:i,connect:function(){return r.channel=t,r.getRoomPlayers(e)}})},i.prototype.getRoomPlayers=function(t){var e=this;return this.PN.here_now({channel:this.channel,state:!0,callback:function(i){return e.handlePlayers(i,t)}})},i.prototype.message=function(t){if(t.type)switch(t.type){case"chat_message":if(a.current_player.id!==t.uuid)return this.publishEvent("messages:received:"+t.uuid,t);break;case"chat_message_dismissed":return this.publishEvent("messages:dismissed:"+t.uuid);case"kick":return this.removePlayer(t.uuid,!0)}},i.prototype.handlePlayers=function(t,e){var i,r,n,o;if(t.uuids)for(o=t.uuids,r=0,n=o.length;n>r;r++)i=o[r],parseInt(i.uuid)!==parseInt(this.player.get("id"))&&this.publishEvent("addPlayer",i.uuid,i.state);return e?e(this.channel):void 0},i.prototype.handlePresence=function(t){if(t.uuid!==a.current_player.id)switch(t.action){case"join":return this.publishEvent("addPlayer",t.uuid,t.data);case"state-change":return this.publishEvent("players:moved:"+t.uuid,t.data);case"leave":return this.publishEvent("players:left",t.uuid);case"timeout":return this.publishEvent("players:left",t.uuid)}},i.prototype.publishPlayerMovement=function(t){var e,i,r,n,o;return n=t.get("x_position"),o=t.get("y_position"),r=t.get("orientation"),i=t.get("name"),e=t.get("moving"),this.setAttrs(t)},i.prototype.removePlayer=function(t,e){return a.current_player.id===t&&(console.log("unsubscribe"),this.PN.unsubscribe({channel:this.channel}),e)?this.notifyKick(t):void 0},i.prototype.publishMessage=function(t){return t.type="chat_message",this.PN.publish({channel:this.channel,message:t})},i.prototype.publishKick=function(t){var e;return e={type:"kick",uuid:t},this.PN.publish({channel:this.channel,message:e})},i.prototype.notifyKick=function(t){return a.current_player.id===t?(console.log("notify!"),new n({template:e("views/templates/kick"),className:"modal",container:document.body,autoRender:!0})):void 0},i.prototype.dismissMessage=function(t){return this.PN.publish({channel:this.channel,message:{type:"chat_message_dismissed",uuid:t}})},i.prototype.setAttrs=function(t){var e;return e=t.toJSON(),delete e.active,this.PN.state({channel:this.channel,state:e})},i}(o)}),require.register("models/player",function(t,e,i){var r,n,o,s,a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};o=e("lib/mediator"),r=e("models/model"),i.exports=n=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.movement_inc=0,e.prototype.defaults={x_position:0,y_position:0},e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.listenTo(this,"change:x_position change:y_position change:orientation change:moving",this.streamPosition),this.listenTo(this,"change:name",this.publishNameChange),this.subscribeEvent("players:moved:"+this.id,this.setPosition),this.subscribeEvent("players:left",this.handleLeave)},e.prototype.position=function(){return""+this.get("x_position")+"px, "+this.get("y_position")+"px"},e.prototype.isCurrentPlayer=function(){return parseInt(o.current_player.id)===parseInt(this.id)},e.prototype.setPosition=function(t){return this.isCurrentPlayer()?void 0:this.set(t)},e.prototype.streamPosition=function(){var t;return this.movement_inc++,t=5===this.movement_inc||this.hasChanged("orientation")||this.hasChanged("moving"),t?(this.movement_inc=0,this.isCurrentPlayer()&&this.publishEvent("playerMoved",this),this.set("z-plane",this.get("y_position"))):void 0},e.prototype.leaveRoom=function(){return this.publishEvent("players:left",this.id)},e.prototype.handleLeave=function(t){return t===this.id?this.dispose():void 0},e.prototype.publishNameChange=function(){return this.isCurrentPlayer()&&this.publishEvent("players:name_changed",this),this.save()},e.prototype.save=function(){var t;return this.isCurrentPlayer()?(t=this.toJSON(),delete t.id,delete t.active,localStorage.setItem("CremalabPartyAvatar",JSON.stringify(this.toJSON())),this.publishEvent("players:avatar_changed",this),this):void 0},e.prototype.dispose=function(){return this.trigger("dispose"),e.__super__.dispose.apply(this,arguments)},e}(r)}),require.register("models/players",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};r=e("./collection"),i.exports=n=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.initialize=function(){var t=this;return e.__super__.initialize.apply(this,arguments),this.subscribeEvent("players:left",function(e){return t.remove(e)})},e}(r)}),require.register("models/trailblazer",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};r=e("models/model"),i.exports=n=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.initialize=function(t){var i=this;return e.__super__.initialize.apply(this,arguments),this.canvas=t.canvas,this.avatar=t.avatar,this.player=this.avatar.model,this.plots=[],this.plot_count=0,this.listenTo(this.player,"change:x_position change:y_position",function(){var t;return i.plot_count++,t={x:i.player.get("x_position"),y:i.player.get("y_position")},i.plots.push(t),i.cleanupPlots(),i.canvas.addPointToTrail(i.getStartEnd(i.plots),i.player,i.avatar)})},e.prototype.getStartEnd=function(t){var e,i;return t.length>1?(e=t[t.length-2],i=t[t.length-1]):(e={x:this.player.get("x_position")+this.avatar.width/1.65,y:this.player.get("y_position")+this.avatar.height},t.length&&(i=t[t.length],i||(i=e))),i.x=i.x+this.avatar.width/1.65,i.y=i.y+this.avatar.height,[e,i]},e.prototype.cleanupPlots=function(){return this.plots.length>10?this.plots.shift():void 0},e}(r)}),require.register("views/avatar",function(t,e,i){var r,n,o,s,a,p,l,c,u,h=function(t,e){return function(){return t.apply(e,arguments)}},d={}.hasOwnProperty,v=function(t,e){function i(){this.constructor=t}for(var r in e)d.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};o=e("./view"),n=e("lib/chatterbox"),p=e("lib/mediator"),a=37,c=38,l=39,s=40,i.exports=r=function(t){function i(){return this.publishClick=h(this.publishClick,this),this.handleKeyUp=h(this.handleKeyUp,this),this.handleKeyDown=h(this.handleKeyDown,this),u=i.__super__.constructor.apply(this,arguments)}return v(i,t),i.prototype.directionsByName={left:a,up:c,right:l,down:s},i.prototype.directionsByCode={37:"left",38:"up",39:"right",40:"down"},i.prototype.template=e("./templates/avatar"),i.prototype.autoRender=!1,i.prototype.className="avatar",i.prototype.movementInc=8,i.prototype.movementLoopInc=30,i.prototype.moving=!1,i.prototype.activeMovementKeys=[],i.prototype.movementKeys=[a,c,l,s],i.prototype.availableDirections={left:!0,right:!0,up:!0,down:!0},i.prototype.initialize=function(t){var e=this;return t.template&&(this.template=t.template),this.soulless=t.soulless,i.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"change:avatar-gender change:avatar-hat change:avatar-hair change:avatar-skin change:avatar-coat change:avatar-pants",this.updateLook),this.listenTo(this.model,"dispose",this.dispose),this.listenTo(this.model,"change:z-plane",this.updateZIndex),this.subscribeEvent("players:left",this.handleLeave),this.model.isCurrentPlayer()||this.listenTo(this.model,"change:moving",function(){return e.setMovementClasses()}),this.soulless||(this.listenTo(this.model,"change:x_position change:y_position change:orientation",this.broadCastMove),this.listenTo(this,"availableDirectionsUpdated",this.updatePosition),this.chatterbox=new n({player:this.model,avatar:this})),this.listenTo(this.model,"change:orientation",this.orient),this.listenTo(this.model,"change:name",this.setName)},i.prototype.render=function(){var t=this;return i.__super__.render.apply(this,arguments),this.soulless?this.orient(this.model,0):(this.positionOnMap(),this.bindEvents(),this.el.setAttribute("data-pos",7),setTimeout(function(){return t.rect=t.el.getClientRects()[0],t.boundingRect=t.el.getBoundingClientRect(),t.setDimensions()},0),this.model.get("active")&&this.el.classList.add("active"),this.model.isCurrentPlayer()&&this.el.addEventListener("touchstart",function(e){return e.preventDefault(),e.stopPropagation(),t.chatterbox.handleEnter()}),this.orient(this.model,this.model.get("orientation"))),this.updateLook(),this.updateZIndex()},i.prototype.bindEvents=function(){return this.el.addEventListener("click",this.publishClick),this.model.isCurrentPlayer()?(document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)):void 0},i.prototype.broadCastMove=function(t){return t.isCurrentPlayer()?void 0:(this.positionOnMap(),this.trigger("playerMove",t,this))},i.prototype.handleKeyDown=function(t){var e=this;return t.stopPropagation(),"modal"!==p.game_state&&(this.isMovementKey(t)&&this.activeMovementKeys.indexOf(t.keyCode)<0&&(this.addActiveMovementKey(t.keyCode),this.moving||this.movementLoop||(this.clearMovementClasses(),this.movementLoop=setInterval(function(){return e.move()},this.movementLoopInc))),16===t.keyCode&&this.addActiveMovementKey(t.keyCode),13===t.keyCode&&this.chatterbox.handleEnter(t),27===t.keyCode)?this.chatterbox.disposeBubble(!0):void 0},i.prototype.move=function(){var t,e;return this.moving=!0,this.model.set("moving",!0),this.checkCollision(),this.isMovingDirection(c)||this.isMovingDirection(s)||this.isMovingDirection(a)||this.isMovingDirection(l)||(this.moving=!1,this.model.set("moving",!1),this.stopMovementLoop()),t=this.model.get("x_position"),e=this.model.get("y_position"),this.isMovingDirection(c)&&(e=this.model.get("y_position")+-this.movementInc),this.isMovingDirection(s)&&(e=this.model.get("y_position")+this.movementInc),this.isMovingDirection(a)&&(t=this.model.get("x_position")+-this.movementInc),this.isMovingDirection(l)&&(t=this.model.get("x_position")+this.movementInc),this.trigger("playerMove",t,e,this),this.setMovementClasses(),this.setOrientation(),this.positionOnMap()},i.prototype.positionOnMap=function(){return this.position_x=this.model.get("x_position"),this.position_y=this.model.get("y_position"),this.el.style.webkitTransform="translate3d("+this.model.position()+", 0)",this.el.style.MozTransform="translate3d("+this.model.position()+", 0)",this.el.style.transform="translate3d("+this.model.position()+", 0)"},i.prototype.addActiveMovementKey=function(t){return this.activeMovementKeys.indexOf(t)<0?this.activeMovementKeys.push(t):void 0},i.prototype.travelToPoint=function(t,e){var i;return i={x:t,y:e},this.autopilot.travelToPoint(i,this)},i.prototype.orient=function(t,e){return this.el.setAttribute("data-pos",e)},i.prototype.handleKeyUp=function(t){return this.stopMovement(t),16===t.keyCode?this.stopMovementDirection(t.keyCode):void 0},i.prototype.stopMovement=function(t){return t&&t.keyCode?(this.activeMovementKeys.indexOf(t.keyCode)>-1&&this.stopMovementDirection(t.keyCode),0===this.activeMovementKeys.length&&(this.stopMovementLoop(),this.moving=!1),this.moving&&this.el.classList.remove(this.directionsByCode[t.keyCode])):(this.stopMovementLoop(),this.activeMovementKeys=[],this.moving=!1),this.setMovementClasses(),this.setOrientation()},i.prototype.isMovementKey=function(t){return this.movementKeys.indexOf(t.keyCode)>-1},i.prototype.isMovingDirection=function(t){return t.isArray?t.every(function(t){return this.activeMovementKeys.indexOf(t)>-1}):this.activeMovementKeys.indexOf(t)>-1},i.prototype.isShiftKeyDown=function(){return this.activeMovementKeys.indexOf(16)>-1},i.prototype.setMovementClasses=function(){var t,e;return t=this.el.classList,e="",this.model.get("moving")?t.add("moving"):t.remove("moving"),this.clearMovementClasses(),this.isMovingDirection(c)&&t.add("dir-up"),this.isMovingDirection(s)&&t.add("dir-down"),this.isMovingDirection(a)&&t.add("dir-left"),this.isMovingDirection(l)?t.add("dir-right"):void 0},i.prototype.setOrientation=function(){var t;return t=this.el.classList,t.contains("dir-up")&&t.contains("dir-left")?this.isShiftKeyDown()?this.model.set("orientation",1):this.model.set("orientation",5):t.contains("dir-up")&&t.contains("dir-right")?this.isShiftKeyDown()?this.model.set("orientation",7):this.model.set("orientation",3):t.contains("dir-down")&&t.contains("dir-left")?this.isShiftKeyDown()?this.model.set("orientation",3):this.model.set("orientation",7):t.contains("dir-down")&&t.contains("dir-right")?this.isShiftKeyDown()?this.model.set("orientation",5):this.model.set("orientation",1):t.contains("dir-up")?this.isShiftKeyDown()?this.model.set("orientation",0):this.model.set("orientation",4):t.contains("dir-down")?this.isShiftKeyDown()?this.model.set("orientation",4):this.model.set("orientation",0):t.contains("dir-right")?this.isShiftKeyDown()?this.model.set("orientation",6):this.model.set("orientation",2):t.contains("dir-left")?this.isShiftKeyDown()?this.model.set("orientation",2):this.model.set("orientation",6):void 0},i.prototype.clearMovementClasses=function(){var t;return t=this.el.classList,t.remove("dir-up"),t.remove("dir-down"),t.remove("dir-left"),t.remove("dir-right")},i.prototype.stopMovementLoop=function(){return clearInterval(this.movementLoop),this.model.set("moving",!1),this.movementLoop=null},i.prototype.stopMovementDirection=function(t){return this.activeMovementKeys.indexOf(t)>-1?this.activeMovementKeys.splice(this.activeMovementKeys.indexOf(t),1):void 0},i.prototype.setDimensions=function(){return this.width=this.rect.right-this.rect.left,this.height=this.rect.bottom-this.rect.top},i.prototype.checkCollision=function(){var t,e,i,r;return r=this.isMovingDirection(c)&&!this.availableDirections.up,t=this.isMovingDirection(s)&&!this.availableDirections.down,e=this.isMovingDirection(a)&&!this.availableDirections.left,i=this.isMovingDirection(l)&&!this.availableDirections.right,r&&this.stopMovementDirection(c),t&&this.stopMovementDirection(s),e&&this.stopMovementDirection(a),i?this.stopMovementDirection(l):void 0},i.prototype.updatePosition=function(t,e){return(t>this.model.get("x_position")&&this.availableDirections.right||t<this.model.get("x_position")&&this.availableDirections.left)&&this.model.set("x_position",t),e>this.model.get("y_position")&&this.availableDirections.down||e<this.model.get("y_position")&&this.availableDirections.up?this.model.set("y_position",e):void 0},i.prototype.isCloseEnoughTo=function(t,e){var i,r;return i=Math.abs(t-this.model.get("x_position"))<20,r=Math.abs(e-this.model.get("y_position"))<20,i&&r},i.prototype.setName=function(){var t;return t=this.model.get("name"),this.el.querySelector(".player-name").innerText=t},i.prototype.updateLook=function(){return this.el.className="avatar",this.model.get("active")&&this.el.classList.add("active"),this.el.setAttribute("data-gender",this.model.get("avatar-gender")),this.el.classList.add(this.model.get("avatar-hat")),this.el.classList.add(this.model.get("avatar-hair")),this.el.classList.add(this.model.get("avatar-skin")),this.el.classList.add(this.model.get("avatar-coat")),this.el.classList.add(this.model.get("avatar-pants")),this.model.isCurrentPlayer()?this.model.save():void 0},i.prototype.updateZIndex=function(){return this.el.style.zIndex=this.model.get("y_position")},i.prototype.handleLeave=function(t){return this.model&&parseInt(t)===parseInt(this.model.id)?this.dispose():void 0},i.prototype.publishClick=function(t){return console.log("click avatar"),this.publishEvent("clickAvatar",this,this.model,t)},i.prototype.dispose=function(){return document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),i.__super__.dispose.apply(this,arguments)},i}(o)}),require.register("views/chat_input_view",function(t,e,i){var r,n,o,s,a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("views/view"),o=e("./templates/chat_input"),i.exports=r=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.template=o,e.prototype.className="chat-dialog speech-bubble",e.prototype.render=function(){var t=this;return e.__super__.render.apply(this,arguments),setTimeout(function(){return t.el.querySelector("input").focus()},0),this.el.querySelector("input").addEventListener("blur",function(){return window.scrollTo(0,0)})},e}(n)}),require.register("views/collection_view",function(t,e,i){"use strict";var r,n,o,s,a,p,l,c=function(t,e){return function(){return t.apply(e,arguments)}},u={}.hasOwnProperty,h=function(t,e){function i(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};o=e("./view"),r=Backbone.$,a=function(t,e){var i,r,n,o;if(!e)return t;for(o=[],r=0,n=t.length;n>r;r++)i=t[r],Backbone.utils.matchesSelector(i,e)&&o.push(i);return o},l=function(){return r?function(t,e){return t.toggle(e)}:function(t,e){return t.style.display=e?"":"none"}}(),s=function(){return r?function(t,e){return t.addClass(e)}:function(t,e){return t.classList.add(e)}}(),p=function(){return r?function(t,e,i,r,n){var o,s,a,p,l;return a=i>0&&r>i,p=function(t){return 0===t||i===t},a||n?(o=t.children(n),s=o.length,o[i]!==e?p(s)?t.append(e):0===i?o.eq(i).before(e):o.eq(i-1).after(e):void 0):(l=p(r)?"append":"prepend",t[l](e))}:function(t,e,i,r,n){var o,s,p,l,c;return p=i>0&&r>i,l=function(t){return 0===t||i===t},p||n?(o=a(t.children,n),s=o.length,o[i]!==e?l(s)?t.appendChild(e):0===i?t.insertBefore(e,o[i]):(c=o[i-1],t.lastChild===c?t.appendChild(e):t.insertBefore(e,c.nextElementSibling)):void 0):l(r)?t.appendChild(e):t.insertBefore(e,t.firstChild)}}(),i.exports=n=function(t){function e(){this.renderAllItems=c(this.renderAllItems,this),this.toggleFallback=c(this.toggleFallback,this),this.itemsReset=c(this.itemsReset,this),this.itemRemoved=c(this.itemRemoved,this),this.itemAdded=c(this.itemAdded,this),this.visibleItems=[],e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.itemView=null,e.prototype.autoRender=!0,e.prototype.renderItems=!0,e.prototype.listSelector=null,e.prototype.$list=null,e.prototype.fallbackSelector=null,e.prototype.$fallback=null,e.prototype.loadingSelector=null,e.prototype.$loading=null,e.prototype.itemSelector=null,e.prototype.filterer=null,e.prototype.filterCallback=function(t,e){return r&&t.$el.stop(!0,!0),l(r?t.$el:t.el,e)},e.prototype.visibleItems=null,e.prototype.optionNames=o.prototype.optionNames.concat(["renderItems","itemView"]),e.prototype.initialize=function(t){return null==t&&(t={}),this.addCollectionListeners(),null!=t.filterer?this.filter(t.filterer):void 0},e.prototype.addCollectionListeners=function(){return this.listenTo(this.collection,"add",this.itemAdded),this.listenTo(this.collection,"remove",this.itemRemoved),this.listenTo(this.collection,"reset sort",this.itemsReset)},e.prototype.getTemplateData=function(){var t;return t={length:this.collection.length},"function"==typeof this.collection.isSynced&&(t.synced=this.collection.isSynced()),t},e.prototype.getTemplateFunction=function(){},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.list=this.el,this.initFallback(),this.initLoadingIndicator(),this.renderItems?this.renderAllItems():void 0},e.prototype.itemAdded=function(t,e,i){return this.insertView(t,this.renderItem(t),i.at)},e.prototype.itemRemoved=function(t){return this.removeViewForItem(t)},e.prototype.itemsReset=function(){return this.renderAllItems()},e.prototype.initFallback=function(){return this.fallbackSelector?(r?this.$fallback=this.$(this.fallbackSelector):this.fallback=this.find(this.fallbackSelector),this.on("visibilityChange",this.toggleFallback),this.listenTo(this.collection,"syncStateChange",this.toggleFallback),this.toggleFallback()):void 0},e.prototype.toggleFallback=function(){var t;return t=0===this.visibleItems.length&&("function"==typeof this.collection.isSynced?this.collection.isSynced():!0),l(r?this.$fallback:this.fallback,t)},e.prototype.initLoadingIndicator=function(){return this.loadingSelector&&"function"==typeof this.collection.isSyncing?(r?this.$loading=this.$(this.loadingSelector):this.loading=this.find(this.loadingSelector),this.listenTo(this.collection,"syncStateChange",this.toggleLoadingIndicator),this.toggleLoadingIndicator()):void 0},e.prototype.toggleLoadingIndicator=function(){var t;return t=0===this.collection.length&&this.collection.isSyncing(),l(r?this.$loading:this.loading,t)},e.prototype.getItemViews=function(){var t,e,i,r;if(t={},this.subviews.length>0){r=this.subviewsByName;for(e in r)i=r[e],"itemView:"===e.slice(0,9)&&(t[e.slice(9)]=i)}return t},e.prototype.filter=function(t,e){var i,r,n,o,s,a,p,l,c=this;if(("function"==typeof t||null===t)&&(this.filterer=t),("function"==typeof e||null===e)&&(this.filterCallback=e),i=function(){var t;if(c.subviews.length>0)for(t in c.subviewsByName)if("itemView:"===t.slice(0,9))return!0;return!1}())for(l=this.collection.models,n=a=0,p=l.length;p>a;n=++a){if(o=l[n],r="function"==typeof this.filterer?this.filterer(o,n):!0,s=this.subview("itemView:"+o.cid),!s)throw new Error("CollectionView#filter: no view found for "+o.cid);this.filterCallback(s,r),this.updateVisibleItems(s.model,r,!1)}return this.trigger("visibilityChange",this.visibleItems)},e.prototype.renderAllItems=function(){var t,e,i,r,n,o,s,a,p,l,c;for(r=this.collection.models,this.visibleItems=[],n={},s=0,p=r.length;p>s;s++)i=r[s],o=this.subview("itemView:"+i.cid),o&&(n[i.cid]=o);c=this.getItemViews();for(t in c)u.call(c,t)&&(o=c[t],t in n||this.removeSubview("itemView:"+t));for(e=a=0,l=r.length;l>a;e=++a)i=r[e],o=this.subview("itemView:"+i.cid),o?this.insertView(i,o,e,!1):this.insertView(i,this.renderItem(i),e);return 0===r.length?this.trigger("visibilityChange",this.visibleItems):void 0},e.prototype.renderItem=function(t){var e;return e=this.subview("itemView:"+t.cid),e||(e=this.initItemView(t),this.subview("itemView:"+t.cid,e)),e.render(),e},e.prototype.initItemView=function(t){if(this.itemView)return new this.itemView({autoRender:!1,model:t});throw new Error("The CollectionView#itemView property must be defined or the initItemView() must be overridden.")},e.prototype.insertView=function(t,e,i){var n,o,s,a;return"number"!=typeof i&&(i=this.collection.indexOf(t)),o="function"==typeof this.filterer?this.filterer(t,i):!0,n=r?e.$el:e.el,this.filterer&&this.filterCallback(e,o),s=this.collection.length,a=r?this.$list:this.list,p(a,n,i,s,this.itemSelector),e.trigger("addedToParent"),this.updateVisibleItems(t,o),e},e.prototype.removeViewForItem=function(t){return this.updateVisibleItems(t,!1),this.removeSubview("itemView:"+t.cid)},e.prototype.updateVisibleItems=function(t,e,i){var r,n,o;return null==i&&(i=!0),n=!1,o=this.visibleItems.indexOf(t),r=-1!==o,e&&!r?(this.visibleItems.push(t),n=!0):!e&&r&&(this.visibleItems.splice(o,1),n=!0),n&&i&&this.trigger("visibilityChange",this.visibleItems),n},e.prototype.dispose=function(){var t,i,r,n;if(!this.disposed){for(i=["$list","$fallback","$loading","visibleItems"],r=0,n=i.length;n>r;r++)t=i[r],delete this[t];
return e.__super__.dispose.apply(this,arguments)}},e}(o)}),require.register("views/dj_view",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("./view"),i.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.audio={},e.prototype.currentTrack="soundtrack",e.prototype.isPlaying=!1,e.prototype.tracks={soundtrack:"https://s3.amazonaws.com/cremalab/bit-shifter-let-it-snow.mp3",disco:"https://s3.amazonaws.com/cremalab/disco.mp3"},e.prototype.trackVolumes={soundtrack:.1,disco:1},e.prototype.initialize=function(){var t,e,i,r;for(r=Object.keys(this.tracks),e=0,i=r.length;i>e;e++)t=r[e],this.audio[t]=new Audio(this.tracks[t]),this.audio[t].loop=!0,this.audio[t].volume=this.trackVolumes[t];return this.playTrack(this.currentTrack)},e.prototype.playTrack=function(t){return this.audio[this.currentTrack].pause(),this.isPlaying!==!1&&this.audio[t].play(),this.currentTrack=t},e.prototype.togglePlayback=function(){return this.isPlaying?(this.audio[this.currentTrack].pause(),this.isPlaying=!1):(this.audio[this.currentTrack].play(),this.isPlaying=!0)},e}(n)}),require.register("views/drawing_canvas",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("./view"),i.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.color="#363f59",e.prototype.lineWidth=50,e.prototype.gameLoopInt=2e3,e.prototype.plotCleanCount=5,e.prototype.cleanup=!1,e.prototype.initialize=function(){var t=this;return e.__super__.initialize.apply(this,arguments),this.plots=[],this.cleanup?setInterval(function(){return t.cleanupPlots()},this.gameLoopInt):void 0},e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.ctx=this.el.getContext("2d"),this.ctx.globalAlpha=.5,this.ctx.globalCompositeOperation="xor",this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.lineWidth,this.ctx.lineCap="round",this.ctx.lineJoin="round"},e.prototype.drawOnCanvas=function(t){var e,i,r,n;if(t.length){for(this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),e=r=0,n=t.length;n>r;e=++r)i=t[e],this.ctx.lineTo(i.x,i.y);return this.ctx.stroke()}},e.prototype.addPointToTrail=function(t){var e,i;return i=t[0],e=t[t.length-1],this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.plots.push(i),this.plots.push(e)},e.prototype.cleanupPlots=function(){return this.plots.splice(0,this.plotCleanCount),this.ctx.restore(),this.ctx.clearRect(0,0,this.el.width,this.el.height),this.drawOnCanvas(this.plots)},e}(n)}),require.register("views/edit_avatar_view",function(t,e,i){var r,n,o,s={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("views/join_game_view"),i.exports=r=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.noClose=!1,e.prototype.render=function(){return e.__super__.render.apply(this,arguments),this.bindForm(),this.el.querySelector("button").innerText="Save Avatar"},e.prototype.bindForm=function(){var t,e,i,r,n,o,s;for(o=Object.keys(this.model.attributes),s=[],r=0,n=o.length;n>r;r++)t=o[r],i=this.model.get(t),e=this.el.querySelector("input[name='"+t+"']"),e?"radio"===e.type?(e=this.el.querySelector("input[name='"+t+"'][value='"+i+"']"),s.push(e?e.checked=!0:void 0)):s.push(e.value=i):s.push(void 0);return s},e}(n)}),require.register("views/hint_view",function(t,e,i){var r,n,o,s,a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("./view"),o=e("./templates/hint"),i.exports=r=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.className="hint",e.prototype.template=o,e.prototype.y_offset=10,e.prototype.x_offset=10,e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),this.listenTo(this.model,"dispose",this.dispose)},e.prototype.render=function(){var t=this;return e.__super__.render.apply(this,arguments),setTimeout(function(){var e,i,r;return t.el.style.position="absolute",r=t.el.getBoundingClientRect(),i=t.model.get("obstruction"),t.el.style.zIndex=i.bottom,e=i.right-i.left,t.model.get("position")&&"right"===t.model.get("position")?(t.el.style.left=i.x+e+t.x_offset+"px",t.el.style.top=t.model.get("obstruction").y-t.y_offset+"px"):(t.el.style.left=i.x-r.width/4+"px",t.el.style.top=t.model.get("obstruction").y-(r.height+t.y_offset)+"px")},0)},e}(n)}),require.register("views/intro_view",function(t,e,i){var r,n,o,s,a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("views/modal_view"),o=e("./templates/intro"),i.exports=r=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.template=o,e.prototype.autoRender=!0,e.prototype.className="modal sub-intro",e.prototype.triggerVolume=!0,e.prototype.initialize=function(t){return t.triggerVolume===!1&&(this.triggerVolume=!1),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){var t,i=this;return e.__super__.render.apply(this,arguments),t=this.el.querySelector("button"),t.addEventListener("click",function(){return i.dispose()})},e.prototype.dispose=function(){return this.trigger("dispose"),this.triggerVolume&&this.publishEvent("togglePlayback"),e.__super__.dispose.apply(this,arguments)},e}(n)}),require.register("views/join_game_view",function(t,e,i){var r,n,o,s,a,p,l={}.hasOwnProperty,c=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};o=e("./modal_view"),r=e("views/avatar"),s=e("lib/mediator"),a=e("./templates/join_game"),i.exports=n=function(t){function e(){return p=e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.template=a,e.prototype.autoRender=!0,e.prototype.tagName="form",e.prototype.noClose=!0,e.prototype.render=function(){var t,i,n,o,a=this;for(e.__super__.render.apply(this,arguments),i=this.el.querySelectorAll("input[type='radio']"),s.game_state="modal",this.avatarView=new r({model:this.model,soulless:!0,container:this.el.querySelector(".avatar-holder"),autoRender:!0}),n=0,o=i.length;o>n;n++)t=i[n],t.addEventListener("change",function(t){var e,i;return e=t.target.name,i=a.el.querySelector("input[name='"+e+"']:checked").value,a.model.set(e,i)});return this.el.addEventListener("submit",function(t){return t.preventDefault(),t.stopPropagation(),a.trigger("setPlayerName",document.getElementById("player_name").value)})},e.prototype.dispose=function(){return s.game_state="playing",this.avatarView.dispose(),e.__super__.dispose.apply(this,arguments)},e}(o)}),require.register("views/map_view",function(t,e,i){var r,n,o,s,a,p,l={}.hasOwnProperty,c=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};r=e("lib/landscaper"),o=e("./view"),s=e("./templates/map"),a="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",i.exports=n=function(t){function e(){return p=e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.template=s,e.prototype.className="map",e.prototype.viewport_padding=300,e.prototype.offset_x=0,e.prototype.offset_y=0,e.prototype.width=2002,e.prototype.height=1500,e.prototype.padding_top=80,e.prototype.padding_bottom=15,e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments),("ontouchstart"in window||"onmsgesturechange"in window)&&(this.mobile=!0),this.landscaper=new r({map:this}),this.subscribeEvent("map:pan_to_player",this.panToPlayerPosition)},e.prototype.render=function(){var t,i=this;return e.__super__.render.apply(this,arguments),this.setDimensions(),this.landscaper.init(),window.addEventListener("resize",function(){return i.setDimensions()}),t=0,document.addEventListener("touchstart",function(e){var i;i=+new Date,t+500>i&&e.preventDefault(),t=i}),this.mobile?document.body.removeChild(document.getElementById("keysHints")):void 0},e.prototype.setDimensions=function(){return this.rect=document.body.getClientRects()[0],this.viewport_padding=this.mobile?{x:.5*this.rect.width,y:.45*this.rect.height}:{x:.3*this.rect.width,y:.3*this.rect.height},this.sidebarWidth=document.body.querySelector(".sidebar").getClientRects()[0].width,this.viewport={left:this.rect.left+this.viewport_padding.x-this.sidebarWidth,top:this.rect.top+this.viewport_padding.y,right:this.rect.right-this.viewport_padding.x,bottom:this.rect.bottom-this.viewport_padding.y}},e.prototype.spawnPlayer=function(t,e){var i=this;return e.container=this.el,e.render(),setTimeout(function(){return i.checkPlayerPosition(t,e)},0)},e.prototype.checkPlayerPosition=function(t,e,i){var r,n,o;return this.canMoveTo(t,e,i),n=t>this.viewport.left&&t<this.viewport.right,o=e>this.viewport.top&&e<this.viewport.bottom,r=n&&o,i&&i.model.isCurrentPlayer()?this.panToPlayerPosition(i.model,i):void 0},e.prototype.panToPlayerPosition=function(t,e,i){var r,n,o,s,a,p,l,c,u,h,d;return this.focusedPlayer=t,h=t.get("x_position"),d=t.get("y_position"),r=e.height||0,n=e.width||0,c=h>this.viewport.right-this.offset_x-n,l=h<this.viewport.left-this.offset_x,p=d>this.viewport.bottom-this.offset_y-r,u=d<this.viewport.top-this.offset_y,s=this.offset_x,a=this.offset_y,l&&(s=this.rect.left+(this.viewport.left-h)),c&&(s=this.rect.left+(this.viewport.right-e.width-h)),u&&(a=this.rect.top+(this.viewport.top-d)),p&&(a=this.rect.top+(this.viewport.bottom-r-d)),o=this.offset_x-(this.viewport_padding.x-n),s+this.offset_x>=0||Math.abs(h+this.viewport_padding.x)>=this.width||(this.offset_x=s),a+this.offset_y>=0||Math.abs(d+this.viewport_padding.y)>=this.height||(this.offset_y=a),this.repositionMap(parseInt(this.offset_x),parseInt(this.offset_y),i)},e.prototype.centerMapOn=function(t,e){var i,r;return i=this.viewport.right/2,r=this.viewport.bottom/2,this.offset_x=this.offset_x-(t-i-150),this.offset_y=this.offset_y-(e-r),Math.abs(this.offset_y-(e-r))>=this.height&&(this.offset_y=-(e-this.viewport.bottom-this.viewport_padding.y/1.6)),Math.abs(this.offset_x-(t-i))>=this.width&&(this.offset_x=-(t-this.viewport.right-this.viewport_padding.x/1.6)),this.repositionMap(parseInt(this.offset_x),parseInt(this.offset_y))},e.prototype.repositionMap=function(t,e,i){return i&&(this.el.addEventListener("transitionend",this.removeTransition,this),this.el.style.transition="all .5s"),this.el.style.webkitTransform="translate3d("+t+"px, "+e+"px, 0)",this.el.style.MozTransform="translate3d("+t+"px, "+e+"px, 0)"},e.prototype.removeTransition=function(){return this.style.transition=null,this.removeEventListener("transitionend",this.addAnimation)},e.prototype.canMoveTo=function(t,e,i){return i?this.landscaper.checkObstructions(t,e,i,this):void 0},e.prototype.addTouchEvents=function(t,e){var i=this;return this.el.addEventListener(e,function(e){var r,n;return t.stopMovement(),r=e.touches[0].clientX-i.sidebarWidth-t.width/2,n=e.touches[0].clientY-t.height/2,i.publishEvent("map:interact",e,r,n),t.travelToPoint(r,n)})},e}(o)}),require.register("views/modal_view",function(t,e,i){var r,n,o,s,a,p=function(t,e){return function(){return t.apply(e,arguments)}},l={}.hasOwnProperty,c=function(t,e){function i(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("views/view"),o=e("lib/mediator"),s=e("./templates/modal"),i.exports=r=function(t){function e(){return this.checkEsc=p(this.checkEsc,this),a=e.__super__.constructor.apply(this,arguments)}return c(e,t),e.prototype.template=s,e.prototype.className="modal",e.prototype.initialize=function(t){return t&&t.template&&(this.template=t.template),e.__super__.initialize.apply(this,arguments)},e.prototype.render=function(){var t=this;return e.__super__.render.apply(this,arguments),o.game_state="modal",this.noClose?void 0:(this.closeButton=document.createElement("a"),this.el.querySelector(".modal-content-box").appendChild(this.closeButton),this.closeButton.setAttribute("href","#"),this.closeButton.className="close icon-close",this.closeButton.addEventListener("click",function(){return t.dispose()}),window.addEventListener("keyup",this.checkEsc))},e.prototype.checkEsc=function(t){return 27===t.keyCode?(t.stopPropagation(),this.dispose()):void 0},e.prototype.dispose=function(){return o.game_state="playing",window.removeEventListener("keyup",this.checkEsc),e.__super__.dispose.apply(this,arguments)},e}(n)}),require.register("views/player_list",function(t,e,i){var r,n,o,s,a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("./collection_view"),r=e("./avatar"),i.exports=o=function(t){function i(){return s=i.__super__.constructor.apply(this,arguments)}return p(i,t),i.prototype.className="playerList",i.prototype.initItemView=function(t){var i,n,o=this;return n=e(t.isCurrentPlayer()?"./templates/avatar":"./templates/avatar_head"),i=new r({model:t,soulless:!0,template:n}),i.el.addEventListener("click",function(){return o.publishEvent("map:pan_to_player",t,i,!0)}),i},i}(n)}),require.register("views/speech_bubble_view",function(t,e,i){var r,n,o,s,a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("views/view"),o=e("./templates/speech_bubble"),i.exports=r=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.className="speech-bubble",e.prototype.template=o,e.prototype.initialize=function(t){return e.__super__.initialize.apply(this,arguments),this.chatterBox=t.chatterBox,this.avatar=t.avatar},e.prototype.render=function(){var t=this;return e.__super__.render.apply(this,arguments),this.avatar.model.isCurrentPlayer()?(this.el.querySelector(".close").addEventListener("click",function(e){return e.stopPropagation(),e.preventDefault(),t.chatterBox.disposeBubble(!0)}),this.el.querySelector(".close").addEventListener("touchstart",function(e){return e.stopPropagation(),e.preventDefault(),t.chatterBox.disposeBubble(!0)})):this.el.removeChild(this.el.querySelector(".close"))},e}(n)}),require.register("views/templates/avatar",function(t,e,i){var r=function(t){var e=[],i=t||{},r=i.name;return e.push('<div class="player-name">'+jade.escape(null==(jade.interp=r)?"":jade.interp)+'</div><div class="avatar-wrap"><div class="body"><div class="hat"></div><div class="head"></div><div class="hair"></div><div class="left eye"></div><div class="right eye"></div><div class="mouth"></div><div class="torso"></div><div class="left leg"></div><div class="right leg"></div><div class="right arm"></div><div class="left arm"></div></div></div>'),e.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/avatar_head",function(t,e,i){var r=function(t){var e=[],i=t||{},r=i.name;return e.push('<div class="player-name">'+jade.escape(null==(jade.interp=r)?"":jade.interp)+'</div><div class="avatar-wrap"><div class="body"><div class="hat"></div><div class="head"></div><div class="hair"></div><div class="left eye"></div><div class="right eye"></div><div class="mouth"></div></div></div>'),e.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/bathroom_photo",function(t,e,i){var r=function(){var t=[];return t.push('<div class="modal-wrap"><div class="modal-content"><div class="modal-content-box"><img src="party/images/bathroom_photo.jpg"/></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/chat_input",function(t,e,i){var r=function(){var t=[];return t.push('<input type="text" placeholder="say something..." name="chat_text" autofocus="autofocus" onFocus="window.scrollTo(0, 0);" autocomplete="off"/>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/hint",function(t,e,i){var r=function(t){var e=[],i=t||{},r=i.text;return e.push(jade.escape(null==(jade.interp=r)?"":jade.interp)),e.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/intro",function(t,e,i){var r=function(){var t=[];return t.push('<div class="modal-wrap"><div class="modal-content"><div class="modal-content-box"><div class="intro"><div class="intro-logo"><img src="party/images/crema-christmas-logo.svg" alt="Cremalab Christmas Icon"/></div><div class="intro-script"><img src="party/images/crema-christmas-script.svg" alt="Crema-Christmas"/></div><p>Welcome to the Crema-christmas Holiday Party (Virtual Edition)!\nThis party uses the latest in internet tech, so leave your old\nbrowsers at the door - and the faster your computer the better\n(this is the 21st century after all)!</p><p><button class="sub-bigGreen sub-width-full">Let\'s Party!</button></p><p>Built using these fine services and tools:</p><div class="services grid align-middle spaced"><div class="grid-items"><div class="service sub-pubnub col"><a href="http://www.pubnub.com" target="_blank"><img src="party/images/logo-pubnub.svg" alt="PubNub"/></a></div><div class="service sub-brunch col"><a href="http://brunch.io" target="_blank"><img src="party/images/logo-brunch.svg" alt="Brunch"/></a></div><div class="service sub-github col"><a href="https://github.com" target="_blank"><img src="party/images/logo-github.svg" alt="Github"/></a></div></div></div><p class="tiny">* best on Modern Browsers &amp; fast computers</p></div></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/join_game",function(t,e,i){var r=function(){var t=[],e=["male","female"],i=["0","1","2","3","4","5","6","7","8"],r=["0","1","2","3","4"],n=["0","1","2","3","4"],i=["0","1","2","3","4","5","6","7","8"];return t.push('<div class="modal-wrap"><div class="modal-content"><div class="modal-content-box"><form><h2>Customize Avatar</h2><input id="player_name" name="name" type="text" placeholder="What\'s your name?"/><div class="grid spaced align-middle break-max-medium"><div class="grid-items"><div class="col"><div class="field sub-colorPicker"><div class="grid align-middle spaced break-max-medium"><div class="grid-items"><div class="row"><div class="col"><div class="field-label">Gender:</div></div><div class="col"><div class="field-input"><div class="colorPicker">'),function(){var i=e;if("number"==typeof i.length)for(var r=0,n=i.length;n>r;r++){var o=i[r],s="avatar-gender";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+">"+jade.escape(null==(jade.interp=o)?"":jade.interp)+"</label>")}else{var n=0;for(var r in i){n++;var o=i[r],s="avatar-gender";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+">"+jade.escape(null==(jade.interp=o)?"":jade.interp)+"</label>")}}}.call(this),t.push('</div></div></div></div><div class="row"><div class="col"><div class="field-label">Hat:</div></div><div class="col"><div class="field-input"><div class="colorPicker">'),function(){var e=i;if("number"==typeof e.length)for(var r=0,n=e.length;n>r;r++){var o=e[r],s="avatar-hat";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}else{var n=0;for(var r in e){n++;var o=e[r],s="avatar-hat";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}}}.call(this),t.push('</div></div></div></div><div class="row"><div class="col"><div class="field-label">Hair:</div></div><div class="col"><div class="field-input"><div class="colorPicker">'),function(){var e=r;if("number"==typeof e.length)for(var i=0,n=e.length;n>i;i++){var o=e[i],s="avatar-hair";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}else{var n=0;for(var i in e){n++;var o=e[i],s="avatar-hair";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}}}.call(this),t.push('</div></div></div></div><div class="row"><div class="col"><div class="field-label">Skin:</div></div><div class="col"><div class="field-input"><div class="colorPicker">'),function(){var e=n;if("number"==typeof e.length)for(var i=0,r=e.length;r>i;i++){var o=e[i],s="avatar-skin";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}else{var r=0;for(var i in e){r++;var o=e[i],s="avatar-skin";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}}}.call(this),t.push('</div></div></div></div><div class="row"><div class="col"><div class="field-label">Coat:</div></div><div class="col"><div class="field-input"><div class="colorPicker">'),function(){var e=i;if("number"==typeof e.length)for(var r=0,n=e.length;n>r;r++){var o=e[r],s="avatar-coat";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}else{var n=0;for(var r in e){n++;var o=e[r],s="avatar-coat";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}}}.call(this),t.push('</div></div></div></div><div class="row"><div class="col"><div class="field-label">Pants:</div></div><div class="col"><div class="field-input"><div class="colorPicker">'),function(){var e=i;if("number"==typeof e.length)for(var r=0,n=e.length;n>r;r++){var o=e[r],s="avatar-pants";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}else{var n=0;for(var r in e){n++;var o=e[r],s="avatar-pants";t.push('<input type="radio"'+jade.attr("name",s,!0,!1)+jade.attr("value",s+"-"+o,!0,!1)+jade.attr("id",s+"-"+o,!0,!1)+"/><label"+jade.attr("for",s+"-"+o,!0,!1)+jade.cls([s+"-"+o],[!0])+"></label>")}}}.call(this),t.push('</div></div></div></div></div></div></div></div><div class="col nest-reset avatar-holder"></div></div></div><button class="sub-width-full">Join the party!</button></form></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/kick",function(t,e,i){var r=function(){var t=[];return t.push('<div class="modal-wrap"><div class="modal-content"><div class="modal-content-box"><h1>You\'ve been kicked.</h1><p>Maybe you were stuck, maybe you were being mean...either way we hope to see you back!</p></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/map",function(t,e,i){var r=function(){var t=[];return t.push('<div id="content"><canvas id="drawCanvas" width="5769" height="4102"></canvas></div><div class="disco"><div class="lights"><div class="light red"></div><div class="light yellow"></div><div class="light green"></div><div class="light blue"></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/modal",function(t,e,i){var r=function(){var t=[];return t.push('<div class="modal-wrap"><div class="modal-content"><div class="modal-content-box"></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/speech_bubble",function(t,e,i){var r=function(t){var e=[],i=t||{},r=i.content;return e.push(jade.escape(null==(jade.interp=r)?"":jade.interp)+'<a href="#" class="close icon-close"></a>'),e.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/templates/team_photo",function(t,e,i){var r=function(){var t=[];return t.push('<div class="modal-wrap"><div class="modal-content"><div class="modal-content-box"><img src="party/images/cremacrew_holiday2014.jpg"/></div></div></div>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof i&&i&&i.exports&&(i.exports=r)}),require.register("views/view",function(t,e,i){var r,n,o,s,a,p,l,c,u={}.hasOwnProperty,h=function(t,e){function i(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},d=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};p=e("lib/mediator"),c=e("lib/utils"),n=e("lib/event_broker"),r=Backbone.$,a=function(){return Function.prototype.bind?function(t,e){return t.bind(e)}:_.bind?_.bind:void 0}(),l=function(){return r?function(t,e){return t.html(e)}:function(t,e){return t.innerHTML=e}}(),s=function(){return r?function(t){var e;return e=r(t.container),"function"==typeof t.containerMethod?t.containerMethod(e,t.el):e[t.containerMethod](t.el)}:function(t){var e;return e="string"==typeof t.container?document.querySelector(t.container):t.container,"function"==typeof t.containerMethod?t.containerMethod(e,t.el):e[t.containerMethod](t.el)}}(),i.exports=o=function(t){function e(t){var i,n,o,s,a=this;if(t)for(i in t)n=t[i],d.call(this.optionNames,i)>=0&&(this[i]=n);s=this.render,this.render=function(){return a.disposed?!1:(s.apply(a,arguments),a.autoAttach&&a.attach.apply(a,arguments),a)},this.subviews=[],this.subviewsByName={},this.noWrap&&(this.region&&(o=p.execute("region:find",this.region),null!=o&&(this.el=null!=o.instance.container?null!=o.instance.region?r(o.instance.container).find(o.selector):o.instance.container:o.instance.$(o.selector))),this.container&&(this.el=this.container)),e.__super__.constructor.apply(this,arguments),this.delegateListeners(),this.model&&this.listenTo(this.model,"dispose",this.dispose),this.collection&&this.listenTo(this.collection,"dispose",function(t){return t&&t!==a.collection?void 0:a.dispose()}),null!=this.regions&&p.execute("region:register",this),this.autoRender&&this.render()}return h(e,t),Backbone.utils.extend(e.prototype,n),e.prototype.autoRender=!1,e.prototype.autoAttach=!0,e.prototype.container=null,e.prototype.containerMethod=r?"append":"appendChild",e.prototype.regions=null,e.prototype.region=null,e.prototype.stale=!1,e.prototype.noWrap=!1,e.prototype.keepElement=!1,e.prototype.subviews=null,e.prototype.subviewsByName=null,e.prototype.optionNames=["autoAttach","autoRender","container","containerMethod","region","regions","noWrap"],e.prototype.delegate=function(t,e,i){var r,n,o,s,p,l;if(Backbone.utils)return Backbone.utils.delegate(this,t,e,i);if("string"!=typeof t)throw new TypeError("View#delegate: first argument must be a string");if(2===arguments.length)s=e;else{if(3!==arguments.length)throw new TypeError("View#delegate: only two or three arguments are allowed");if(l=e,"string"!=typeof l)throw new TypeError("View#delegate: second argument must be a string");s=i}if("function"!=typeof s)throw new TypeError("View#delegate: handler argument must be function");return p=function(){var e,i,r,o;for(r=t.split(" "),o=[],e=0,i=r.length;i>e;e++)n=r[e],o.push(""+n+".delegate"+this.cid);return o}.call(this),o=p.join(" "),r=a(s,this),this.$el.on(o,l||null,r),r},e.prototype._delegateEvents=function(t){var e,i,r,n,o,s,p;if(2===Backbone.View.prototype.delegateEvents.length)return Backbone.View.prototype.delegateEvents.call(this,t,!0);for(n in t){if(p=t[n],r="function"==typeof p?p:this[p],!r)throw new Error("Method '"+p+"' does not exist");o=n.match(/^(\S+)\s*(.*)$/),i=""+o[1]+".delegateEvents"+this.cid,s=o[2],e=a(r,this),this.$el.on(i,s||null,e)}},e.prototype.delegateEvents=function(t,e){var i,r,n,o;if(e||this.undelegateEvents(),t)return this._delegateEvents(t);for(o=c.getAllPropertyVersions(this,"events"),r=0,n=o.length;n>r;r++)i=o[r],"function"==typeof i&&(i=i.call(this)),this._delegateEvents(i)},e.prototype.undelegate=function(t,e,i){var r,n,o,s,a;if(Backbone.utils)return Backbone.utils.undelegate(this,t,e,i);if(t){if("string"!=typeof t)throw new TypeError("View#undelegate: first argument must be a string");if(2===arguments.length)"string"==typeof e?a=e:o=e;else if(3===arguments.length){if(a=e,"string"!=typeof a)throw new TypeError("View#undelegate: second argument must be a string");o=i}return s=function(){var e,i,n,o;for(n=t.split(" "),o=[],e=0,i=n.length;i>e;e++)r=n[e],o.push(""+r+".delegate"+this.cid);return o}.call(this),n=s.join(" "),this.$el.off(n,a||null)}return this.$el.off(".delegate"+this.cid)},e.prototype.delegateListeners=function(){var t,e,i,r,n,o,s,a,p;if(this.listen)for(a=c.getAllPropertyVersions(this,"listen"),o=0,s=a.length;s>o;o++){n=a[o],"function"==typeof n&&(n=n.call(this));for(e in n){if(i=n[e],"function"!=typeof i&&(i=this[i]),"function"!=typeof i)throw new Error("View#delegateListeners: "+('listener for "'+e+'" must be function'));p=e.split(" "),t=p[0],r=p[1],this.delegateListener(t,r,i)}}},e.prototype.delegateListener=function(t,e,i){var r;"model"===e||"collection"===e?(r=this[e],r&&this.listenTo(r,t,i)):"mediator"===e?this.subscribeEvent(t,i):e||this.on(t,i,this)},e.prototype.subview=function(t,e){var i,r;return r=this.subviews,i=this.subviewsByName,t&&e?(this.removeSubview(t),r.push(e),i[t]=e,e):t?i[t]:void 0},e.prototype.removeSubview=function(t){var e,i,r,n,o,s,a;if(t){if(s=this.subviews,e=this.subviewsByName,"string"==typeof t)r=t,a=e[r];else{a=t;for(n in e)if(o=e[n],o===a){r=n;break}}if(r&&a&&a.dispose)return a.dispose(),i=s.indexOf(a),-1!==i&&s.splice(i,1),delete e[r]}},e.prototype.getTemplateData=function(){var t,e;return t=this.model?c.serialize(this.model):this.collection?{items:c.serialize(this.collection),length:this.collection.length}:{},e=this.model||this.collection,e&&("function"!=typeof e.isSynced||"synced"in t||(t.synced=e.isSynced())),t
},e.prototype.getTemplateFunction=function(){throw new Error("View#getTemplateFunction must be overridden")},e.prototype.render=function(){var t,e,i;if(this.disposed)return!1;if(i=this.getTemplateFunction(),"function"==typeof i)if(e=i(this.getTemplateData()),this.noWrap){if(t=document.createElement("div"),t.innerHTML=e,t.children.length>1)throw new Error("There must be a single top-level element when using `noWrap`.");this.undelegateEvents(),this.setElement(t.firstChild,!0)}else l(r?this.$el:this.el,e);return this},e.prototype.attach=function(){return null!=this.region&&p.execute("region:show",this.region,this),this.container&&!document.body.contains(this.el)?(s(this),this.trigger("addedToDOM")):void 0},e.prototype.disposed=!1,e.prototype.dispose=function(){var t,e,i,r,n,o,s,a;if(!this.disposed){for(a=this.subviews,r=0,o=a.length;o>r;r++)i=a[r],i.dispose();for(this.unsubscribeAllEvents(),this.off(),this.keepElement?(this.undelegateEvents(),this.undelegate(),this.stopListening()):this.remove(),e=["el","$el","options","model","collection","subviews","subviewsByName","_callbacks"],n=0,s=e.length;s>n;n++)t=e[n],delete this[t];return this.disposed=!0,"function"==typeof Object.freeze?Object.freeze(this):void 0}},e.prototype.getTemplateFunction=function(){return this.template},e}(Backbone.NativeView)});